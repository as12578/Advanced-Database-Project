# Test 20
# From a student in 2017
begin(T1)

begin(T2)

W(T1,x2,9)

# T1 abort
fail(1)

end(T1)
T1 aborts

begin(T3)

W(T3,x2,100)

end(T3)
T3 commits

recover(1)

fail(2)
{'T2': {'readOnly': False, 'pendingOperation': {'operation': <Operation.NONE: 0>, 'options': {}}, 'startTime': 2, 'locks': {}, 'failed': False}}
defaultdict(<class 'list'>, {'T2': [' ']})
Cycle? False

fail(3)

fail(4)

fail(5)

fail(6)

fail(7)

fail(8)

fail(9)

fail(10)

# T2 can't read x2 from site 1,
R(T2,x2)

# but doesn't hold a lock on x2 at site 1
begin(T5)
{'T2': {'readOnly': False, 'pendingOperation': {'operation': <Operation.READ: 1>, 'options': {'key': 'x2'}}, 'startTime': 2, 'locks': {'x2': {'1': {}}}, 'failed': False}}
defaultdict(<class 'list'>, {'T2': [' ', 'x2.1'], 'x2.1': [' ']})
Cycle? False

# T5 doesn't need to wait because T2 doesn't acquire a lock
W(T5,x2,90)

# since site 1 can't respond to the read.
# T2 should read x2 now
end(T5)
T5 commits
T2 - x2: 90


=============================System State=============================
Current Time = 22

=========================Current Transactions=========================
Transaction: T2
Read Only: False
Start Time: 2
Aborted: False
Locks:
	x2: 1:SHARED:22
Pending Operation: 

======================================================================

============================All Site State============================
Site: 1
Start Time: 9
Available: True
Granted Locks:
	x2: T2:SHARED
Waiting Locks:
	
All Data:
	x2: :20:0 T5:90:22
	x4: :40:0
	x6: :60:0
	x8: :80:0
	x10: :100:0
	x12: :120:0
	x14: :140:0
	x16: :160:0
	x18: :180:0
	x20: :200:0
Pending Operations:


Site: 2
Start Time: 0
Available: False
Granted Locks:
	
Waiting Locks:
	
All Data:
	x1: :10:0
	x2: :20:0 T3:100:8
	x4: :40:0
	x6: :60:0
	x8: :80:0
	x10: :100:0
	x11: :110:0
	x12: :120:0
	x14: :140:0
	x16: :160:0
	x18: :180:0
	x20: :200:0
Pending Operations:


Site: 3
Start Time: 0
Available: False
Granted Locks:
	
Waiting Locks:
	
All Data:
	x2: :20:0 T3:100:8
	x4: :40:0
	x6: :60:0
	x8: :80:0
	x10: :100:0
	x12: :120:0
	x14: :140:0
	x16: :160:0
	x18: :180:0
	x20: :200:0
Pending Operations:


Site: 4
Start Time: 0
Available: False
Granted Locks:
	
Waiting Locks:
	
All Data:
	x2: :20:0 T3:100:8
	x3: :30:0
	x4: :40:0
	x6: :60:0
	x8: :80:0
	x10: :100:0
	x12: :120:0
	x13: :130:0
	x14: :140:0
	x16: :160:0
	x18: :180:0
	x20: :200:0
Pending Operations:


Site: 5
Start Time: 0
Available: False
Granted Locks:
	
Waiting Locks:
	
All Data:
	x2: :20:0 T3:100:8
	x4: :40:0
	x6: :60:0
	x8: :80:0
	x10: :100:0
	x12: :120:0
	x14: :140:0
	x16: :160:0
	x18: :180:0
	x20: :200:0
Pending Operations:


Site: 6
Start Time: 0
Available: False
Granted Locks:
	
Waiting Locks:
	
All Data:
	x2: :20:0 T3:100:8
	x4: :40:0
	x5: :50:0
	x6: :60:0
	x8: :80:0
	x10: :100:0
	x12: :120:0
	x14: :140:0
	x15: :150:0
	x16: :160:0
	x18: :180:0
	x20: :200:0
Pending Operations:


Site: 7
Start Time: 0
Available: False
Granted Locks:
	
Waiting Locks:
	
All Data:
	x2: :20:0 T3:100:8
	x4: :40:0
	x6: :60:0
	x8: :80:0
	x10: :100:0
	x12: :120:0
	x14: :140:0
	x16: :160:0
	x18: :180:0
	x20: :200:0
Pending Operations:


Site: 8
Start Time: 0
Available: False
Granted Locks:
	
Waiting Locks:
	
All Data:
	x2: :20:0 T3:100:8
	x4: :40:0
	x6: :60:0
	x7: :70:0
	x8: :80:0
	x10: :100:0
	x12: :120:0
	x14: :140:0
	x16: :160:0
	x17: :170:0
	x18: :180:0
	x20: :200:0
Pending Operations:


Site: 9
Start Time: 0
Available: False
Granted Locks:
	
Waiting Locks:
	
All Data:
	x2: :20:0 T3:100:8
	x4: :40:0
	x6: :60:0
	x8: :80:0
	x10: :100:0
	x12: :120:0
	x14: :140:0
	x16: :160:0
	x18: :180:0
	x20: :200:0
Pending Operations:


Site: 10
Start Time: 0
Available: False
Granted Locks:
	
Waiting Locks:
	
All Data:
	x2: :20:0 T3:100:8
	x4: :40:0
	x6: :60:0
	x8: :80:0
	x9: :90:0
	x10: :100:0
	x12: :120:0
	x14: :140:0
	x16: :160:0
	x18: :180:0
	x19: :190:0
	x20: :200:0
Pending Operations:


======================================================================
======================================================================
