# Mix of transaction aborts and commits, with RO transactions
begin(T1)

beginRO(T2)

begin(T3)

begin(T4)

# Get shared lock on x1 site 2
R(T1,x1)
T1 - x1: 10

# Get exclusive lock on x1 site 2
W(T1,x1,101)

# T3 will wait for T1 on x1 site 2
R(T3, x1)

# Read value since lock already held. Read 101
R(T1,x1)
T1 - x1: 101

# T4 will wait for T3 on x1 site 2
R(T4, x1)

# Abort T1. T3, T4 should not be aborted
fail(2)

# T2 Will use MVRC for x1. Should read 10. Will wait since site 2 is failed
R(T2,x1)

# T1 aborts
end(T1)
T1 aborts

# T2, T3, T4 will read x1: Should read 10
recover(2)

# T3 wil read x2: Should read 20
W(T3, x2, 100)
T4 - x1: 10
T2 - x1: 10

# T3 will wait since 2 transactions hold shared lock
W(T3, x1, 150)

# T4 commits, T3 will write
end(T4)
T4 commits

# T3 will read 150
R(T3, x1)
T3 - x1: 150

# T3 commits
end(T3)
T3 commits

dump(x1)
Site 2 - x1: 150

dump(x2)
Site 1 - x2: 100
Site 2 - x2: 20
Site 3 - x2: 20
Site 4 - x2: 20
Site 5 - x2: 20
Site 6 - x2: 20
Site 7 - x2: 20
Site 8 - x2: 20
Site 9 - x2: 20
Site 10 - x2: 20

# T2 will read 20
R(T2, x2)
T2 - x2: 20

# T2 commits
end(T2)
T2 commits

dump(x1)
Site 2 - x1: 150

dump(x2)
Site 1 - x2: 100
Site 2 - x2: 20
Site 3 - x2: 20
Site 4 - x2: 20
Site 5 - x2: 20
Site 6 - x2: 20
Site 7 - x2: 20
Site 8 - x2: 20
Site 9 - x2: 20
Site 10 - x2: 20


=============================System State=============================
Current Time = 24

=========================Current Transactions=========================
======================================================================

============================All Site State============================
Site: 1
Start Time: 0
Available: True
Stable: True
Granted Locks:
	
Waiting Locks:
	
All Data:
	x2: :20:0 T3:100:18
	x4: :40:0
	x6: :60:0
	x8: :80:0
	x10: :100:0
	x12: :120:0
	x14: :140:0
	x16: :160:0
	x18: :180:0
	x20: :200:0
Pending Operations: 

Site: 2
Start Time: 13
Available: True
Stable: True
Granted Locks:
	
Waiting Locks:
	
All Data:
	x1: :10:0 T3:150:18
	x2: :20:0
	x4: :40:0
	x6: :60:0
	x8: :80:0
	x10: :100:0
	x11: :110:0
	x12: :120:0
	x14: :140:0
	x16: :160:0
	x18: :180:0
	x20: :200:0
Pending Operations: 

Site: 3
Start Time: 0
Available: True
Stable: True
Granted Locks:
	
Waiting Locks:
	
All Data:
	x2: :20:0
	x4: :40:0
	x6: :60:0
	x8: :80:0
	x10: :100:0
	x12: :120:0
	x14: :140:0
	x16: :160:0
	x18: :180:0
	x20: :200:0
Pending Operations: 

Site: 4
Start Time: 0
Available: True
Stable: True
Granted Locks:
	
Waiting Locks:
	
All Data:
	x2: :20:0
	x3: :30:0
	x4: :40:0
	x6: :60:0
	x8: :80:0
	x10: :100:0
	x12: :120:0
	x13: :130:0
	x14: :140:0
	x16: :160:0
	x18: :180:0
	x20: :200:0
Pending Operations: 

Site: 5
Start Time: 0
Available: True
Stable: True
Granted Locks:
	
Waiting Locks:
	
All Data:
	x2: :20:0
	x4: :40:0
	x6: :60:0
	x8: :80:0
	x10: :100:0
	x12: :120:0
	x14: :140:0
	x16: :160:0
	x18: :180:0
	x20: :200:0
Pending Operations: 

Site: 6
Start Time: 0
Available: True
Stable: True
Granted Locks:
	
Waiting Locks:
	
All Data:
	x2: :20:0
	x4: :40:0
	x5: :50:0
	x6: :60:0
	x8: :80:0
	x10: :100:0
	x12: :120:0
	x14: :140:0
	x15: :150:0
	x16: :160:0
	x18: :180:0
	x20: :200:0
Pending Operations: 

Site: 7
Start Time: 0
Available: True
Stable: True
Granted Locks:
	
Waiting Locks:
	
All Data:
	x2: :20:0
	x4: :40:0
	x6: :60:0
	x8: :80:0
	x10: :100:0
	x12: :120:0
	x14: :140:0
	x16: :160:0
	x18: :180:0
	x20: :200:0
Pending Operations: 

Site: 8
Start Time: 0
Available: True
Stable: True
Granted Locks:
	
Waiting Locks:
	
All Data:
	x2: :20:0
	x4: :40:0
	x6: :60:0
	x7: :70:0
	x8: :80:0
	x10: :100:0
	x12: :120:0
	x14: :140:0
	x16: :160:0
	x17: :170:0
	x18: :180:0
	x20: :200:0
Pending Operations: 

Site: 9
Start Time: 0
Available: True
Stable: True
Granted Locks:
	
Waiting Locks:
	
All Data:
	x2: :20:0
	x4: :40:0
	x6: :60:0
	x8: :80:0
	x10: :100:0
	x12: :120:0
	x14: :140:0
	x16: :160:0
	x18: :180:0
	x20: :200:0
Pending Operations: 

Site: 10
Start Time: 0
Available: True
Stable: True
Granted Locks:
	
Waiting Locks:
	
All Data:
	x2: :20:0
	x4: :40:0
	x6: :60:0
	x8: :80:0
	x9: :90:0
	x10: :100:0
	x12: :120:0
	x14: :140:0
	x16: :160:0
	x18: :180:0
	x19: :190:0
	x20: :200:0
Pending Operations: 

======================================================================
======================================================================
